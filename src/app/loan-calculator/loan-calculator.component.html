<div class="container">
  <app-calculator-header />

  <div class="main-content">
    <div class="form-panel">
      <app-loan-form
        [principalDisplay]="principalDisplay"
        [annualRate]="annualRate"
        [tenureYears]="tenureYears"
        [tenureMonths]="tenureMonths"
        [startDate]="startDate"
        (principalChange)="onPrincipalChange($event)"
        (annualRateChange)="annualRate = $event"
        (tenureYearsChange)="tenureYears = $event"
        (tenureMonthsChange)="tenureMonths = $event"
        (startDateChange)="startDate = $event"
        (calculate)="calculate()"
        (reset)="resetAll()"
      />

      <div class="extra-payment-row">
        <button type="button" class="btn btn-extra" (click)="openExtraPaymentDialog()">
          {{ extraPayment ? 'Edit' : 'Add' }} one-time extra payment
        </button>
        @if (extraPayment && extraPayment > 0) {
          <span class="extra-badge">â‚¹ {{ extraPaymentDisplay }}</span>
          <button type="button" class="btn btn-compare" (click)="compareWithExtraPayment()">
            Compare
          </button>
        }
      </div>

      @if (emi > 0) {
        <app-loan-summary
          [emi]="emi"
          [totalInterest]="totalInterest"
          [totalPayable]="totalPayable"
        />
      }
    </div>

    @if (displaySchedule.length) {
      <app-amortization-table
        [schedule]="displaySchedule"
        [comparison]="comparison"
        [extraPaymentAmount]="extraPayment"
        [extraPaymentAtMonth]="extraPaymentAtMonth"
        [extraPaymentDate]="extraPaymentDate"
        [selectedStrategy]="selectedStrategy"
        [displayEmi]="displayEmi"
        [displayTenureMonths]="displayTenureMonths"
        [isShowingOriginalSchedule]="isShowingOriginalSchedule"
        (strategyChange)="onStrategyChange($event)"
      />
    }
  </div>
</div>

<app-extra-payment-input-dialog
  [visible]="showExtraPaymentDialog"
  [initialAmount]="extraPayment"
  [initialDisplay]="extraPaymentDisplay"
  [initialAtMonth]="extraPaymentAtMonth"
  [initialPaymentDate]="extraPaymentDate"
  [startDate]="startDate"
  (apply)="onExtraPaymentApply($event)"
  (closed)="showExtraPaymentDialog = false"
/>

@if (comparison) {
  <app-extra-payment-comparison
    [comparison]="comparison"
    [extraPaymentAmount]="extraPayment"
    [extraPaymentAtMonth]="extraPaymentAtMonth"
    (close)="clearComparison()"
  />
}
