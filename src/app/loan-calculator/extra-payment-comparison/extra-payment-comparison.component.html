@if (comparison) {
  <div class="comparison-panel">
    <div class="comparison-header">
      <h2>Extra Payment Comparison</h2>
      <button class="btn btn-secondary btn-sm" (click)="onClose()">Close Comparison</button>
    </div>

    @if (extraPaymentAmount != null && extraPaymentAmount > 0) {
      <div class="extra-summary">
        <span class="extra-summary-label">Extra amount added</span>
        <span class="extra-summary-amount">₹ {{ extraPaymentAmount | formatCurrency }}</span>
        <span class="extra-summary-when">{{ extraPaymentLabel }}</span>
      </div>
    }

    <div class="comparison-table-wrapper">
      <table class="comparison-table">
        <thead>
          <tr>
            <th class="col-metric">Metric</th>
            <th class="col-original">Original</th>
            <th class="col-option">Reduce EMI</th>
            <th class="col-option">Reduce Tenure</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="col-metric">Monthly EMI</td>
            <td class="col-original">₹ {{ comparison.original.emi | formatCurrency }}</td>
            <td class="col-option">
              <span class="cell-value">₹ {{ comparison.withExtraPaymentReduceEmi.emi | formatCurrency }}</span>
              <span class="cell-delta positive">
                Save ₹ {{ (comparison.original.emi - comparison.withExtraPaymentReduceEmi.emi) | formatCurrency }}/mo
              </span>
            </td>
            <td class="col-option">
              <span class="cell-value">₹ {{ comparison.withExtraPaymentReduceTenure.emi | formatCurrency }}</span>
              <span class="cell-delta neutral">Same EMI</span>
            </td>
          </tr>
          <tr>
            <td class="col-metric">Tenure</td>
            <td class="col-original">{{ comparison.original.schedule.length }} months</td>
            <td class="col-option">
              <span class="cell-value">{{ comparison.withExtraPaymentReduceEmi.schedule.length }} months</span>
              <span class="cell-delta neutral">Same tenure</span>
            </td>
            <td class="col-option">
              <span class="cell-value">{{ comparison.withExtraPaymentReduceTenure.schedule.length }} months</span>
              <span class="cell-delta positive">
                {{ comparison.original.schedule.length - comparison.withExtraPaymentReduceTenure.schedule.length }} months early
              </span>
            </td>
          </tr>
          <tr>
            <td class="col-metric">Total Interest</td>
            <td class="col-original">₹ {{ comparison.original.totalInterest | formatCurrency }}</td>
            <td class="col-option">
              <span class="cell-value">₹ {{ comparison.withExtraPaymentReduceEmi.totalInterest | formatCurrency }}</span>
              <span class="cell-delta positive">
                Save ₹ {{ (comparison.original.totalInterest - comparison.withExtraPaymentReduceEmi.totalInterest) | formatCurrency }}
              </span>
            </td>
            <td class="col-option">
              <span class="cell-value">₹ {{ comparison.withExtraPaymentReduceTenure.totalInterest | formatCurrency }}</span>
              <span class="cell-delta positive">
                Save ₹ {{ (comparison.original.totalInterest - comparison.withExtraPaymentReduceTenure.totalInterest) | formatCurrency }}
              </span>
            </td>
          </tr>
          <tr>
            <td class="col-metric">Total Payable</td>
            <td class="col-original">₹ {{ comparison.original.totalPayable | formatCurrency }}</td>
            <td class="col-option">
              <span class="cell-value">₹ {{ comparison.withExtraPaymentReduceEmi.totalPayable | formatCurrency }}</span>
              <span class="cell-delta positive">
                ₹ {{ (comparison.original.totalPayable - comparison.withExtraPaymentReduceEmi.totalPayable) | formatCurrency }} less
              </span>
            </td>
            <td class="col-option">
              <span class="cell-value">₹ {{ comparison.withExtraPaymentReduceTenure.totalPayable | formatCurrency }}</span>
              <span class="cell-delta positive">
                ₹ {{ (comparison.original.totalPayable - comparison.withExtraPaymentReduceTenure.totalPayable) | formatCurrency }} less
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
}
